# Bazel configuration for cuenv

# Common flags
build --enable_platform_specific_config
build --incompatible_enable_cc_toolchain_resolution

# Performance
build --jobs=auto
build --experimental_reuse_sandbox_directories
build --experimental_persistent_javac
build --experimental_strict_action_env

# Remote cache configuration
# Use cuenv's own remote cache implementation
build:remote --remote_cache=grpc://localhost:50051
build:remote --remote_instance_name=cuenv-main
build:remote --remote_timeout=3600
build:remote --remote_upload_local_results=true
build:remote --remote_cache_compression

# Platform-specific configurations
build:linux --copt=-fPIC
build:linux --linkopt=-Wl,--as-needed
build:linux --host_copt=-fPIC

build:macos --copt=-mmacosx-version-min=10.15
build:macos --linkopt=-mmacosx-version-min=10.15

# Rust configuration
build --@rules_rust//:extra_rustc_flags=-Dwarnings
build --@rules_rust//:extra_rustc_flags=-Aunused
build --aspects=@rules_rust//rust:defs.bzl%rust_clippy_aspect
build --output_groups=+clippy_checks

# Test configuration
test --test_output=errors
test --test_summary=short
test --test_env=RUST_BACKTRACE=1

# Debug builds
build:debug -c dbg
build:debug --strip=never
build:debug --@rules_rust//:extra_rustc_flags=-Cdebuginfo=2

# Release builds
build:release -c opt
build:release --@rules_rust//:extra_rustc_flags=-Clto=thin
build:release --@rules_rust//:extra_rustc_flags=-Ccodegen-units=1